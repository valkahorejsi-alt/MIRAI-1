<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI R츼DCE</title>
    <style>
   
    :root { 
        --primary: #e2774a; 
        --accent: #FF4B2B; 
        --glass: #ffffff;
    }

    body { 
        font-family: 'Segoe UI', system-ui, sans-serif; 
        background: linear-gradient(135deg, #959595 0%, #e7e7e7 100%); 
        margin: 0; 
        padding: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
    }

    .box { 
        width: 100%;
        max-width: 1000px; 
        background: var(--glass); 
        padding: 30px 20px; 
        border-radius: 40px; 
        box-shadow: 0 15px 40px rgba(0,0,0,0.15); 
        box-sizing: border-box; 
        text-align: center;
    }

    h1 { 
        color: var(--primary); 
        font-size: 2.2rem; 
        margin: 0 0 10px 0;
        font-weight: 700;
    }

    .instrukce {
        color: #444;
        font-size: 1.0rem;
        margin-bottom: 20px;
        font-weight: 500;
    }

    /* OB콎칈 TLA캛칈TKO */
    .mikrofon-btn { 
        background: linear-gradient(145deg, #dfa162, #ff8800);
        color: rgb(255, 255, 255); 
        border: 10px solid rgb(255, 255, 255); /* V칳razn칳 okraj */
        width: 100vw; /* Zabere 85% 코칤콏ky displeje */
        height: 100vw; 
        max-width: 500px; /* Ale na po캜칤ta캜i se nezbl치zn칤 */
        max-height: 500px; 
        border-radius: 50%; 
        font-size: 2.5rem; /* Ob콏칤 p칤smo */
        font-weight: 900; 
        cursor: pointer; 
        margin: 10px auto; 
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        box-shadow: 0 15px 35px rgba(226, 175, 74, 0.5);
        transition: transform 0.2s;
        -webkit-tap-highlight-color: transparent;
    }


    .mikrofon-btn span {

        font-size: 5rem; /* Ob콏칤 emoji */


        margin-bottom: 10px;
    
    }
    .mikrofon-btn:active {
        transform: scale(0.92);
    }

    .mikrofon-btn.aktivni { 
        background: linear-gradient(145deg, #FF4B2B, #D4145A); 
        border-color: #fff;
        animation: pulse-ring 1.2s infinite;
    }

    @keyframes pulse-ring {
        0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 106, 80, 0.534); }
        70% { transform: scale(1.1); box-shadow: 0 0 0 35px rgba(255, 255, 255, 0); }
        100% { transform: scale(1); }
    }

    #stav { 
        font-size: 1.5rem; 
        font-weight: 800; 
        color: #a8a8a8; 
        margin-top: 20px;
        text-transform: uppercase;
    }

    #textOdpovedi { 
        font-size: 2.2rem; /* Trochu zv캩t코칤me p칤smo, kdy u nen칤 jen velk칠 */
        line-height: 1.3;  /* Zv캩t코칤me mezery mezi 콏치dky pro lep코칤 캜ten칤 */
        color: #000000; 
        font-weight: 600;  /* P칤smo nech치me tu캜n캩j코칤 */
        text-transform: none; /* ZM캨NA: Tady mus칤 b칳t 'none' m칤sto 'uppercase' */
        text-align: left; 
        background: #fdfdfd;
        padding: 25px;
        border-radius: 25px;
        margin-top: 25px;
        border: 5px solid var(--primary);
        word-wrap: break-word;
    }

    /* Small Screen Adjustment */
    @media (max-width: 400px) {
        .box { padding: 30px 20px; }
        .mikrofon-btn { width: 150px; height: 150px; }
        #textOdpovedi { font-size: 1.8rem; }
    }
</style>
</head>
<body>

<div class="box">
    <h1>BABI캛캛IN MOUDR칗 R츼DCE</h1>
    <button id="mikrofonBtn" class="mikrofon-btn" onclick="spustitSluch()">
    MLUVIT
    </button>
    <div id="stav" style="font-size: 24px; font-weight: bold; color: #555;">P콎IPRAVENO</div>
    <div id="textOdpovedi"></div>
</div>
<script>
    const GEMINI_API_KEY = "AIzaSyDa1Rzw37OOI8ZVANbwpjzJtg7vFwmNPVM"; 

    const btn = document.getElementById('mikrofonBtn');
    const stav = document.getElementById('stav');
    const textOdpovedi = document.getElementById('textOdpovedi');

    const Recognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const r = new Recognition();
    r.lang = 'cs-CZ';
    r.continuous = true; 

    let timeoutPoslechu;

    function spustitSluch() {
        try {
            r.start();
            btn.classList.add('aktivni');
            btn.innerHTML = "游녝<br>POSLOUCH츼M";
            stav.innerText = "TE캝 MLUVTE (M츼TE 5 VTE콎IN)...";

            clearTimeout(timeoutPoslechu);
            timeoutPoslechu = setTimeout(() => { r.stop(); }, 5000); 
        } catch (e) { console.log("Hlas u b캩쮂."); }
    }

    r.onresult = (event) => {
        let finalniText = "";
        for (let i = event.resultIndex; i < event.results.length; ++i) {
            finalniText += event.results[i][0].transcript;
        }
        if (finalniText.trim() !== "") {
            stav.innerText = "SLYEL JSEM: " + finalniText;
            poslatDoAI(finalniText);
        }
    };

    r.onend = () => {
        btn.classList.remove('aktivni');
        btn.innerHTML = "游꿗<br>MLUVIT";
    };
    
    
    async function poslatDoAI(otazka) {
        // --- UKL츼D츼N칈 DO TABULKY (z콢st치v치 stejn칠) ---
        const urlTabulky = "https://script.google.com/macros/s/AKfycbz2I1qtwLtsjKTLrs1unYlk0l6MopEy8PWT8cKfVd5Rv_9bdwRD2ntUx4lh3KUQdRatrQ/exec";
        fetch(urlTabulky, { method: "POST", mode: "no-cors", body: JSON.stringify({ otazka: otazka }) });

        stav.innerText = "P콎EM칗L칈M...";
        textOdpovedi.style.display = "block";
        textOdpovedi.innerText = "PO캛KEJTE PROS칈M...";

        // ZM캨NA: Pou쬴jeme verzi "v1", kter치 je u modelu 1.5 Flash nyn칤 standardem
        const API_URL = `https://generativelanguage.googleapis.com/v1/models/gemini-2.5-flash:generateContent?key=${GEMINI_API_KEY}`;
        
        try {
            const response = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    contents: [{
                        parts: [{
                            text: `Jsi seri칩zn칤 seniorn칤 a laskav칳 캜esk칳 asistent pro mu쬰 . 
                            Mluv slu코n캩, vyjme캜n캩 pou쮂셨ej vtipy, kter칠 budou v kaptegorii vtip콢 se slovy.  
                            Odpov칤dej stru캜n캩, 캜esky a v souladu s 캜esk칳mi gramatick칳mi pravidly(speci치ln캩 sklo켿ov치n칤).
                            Vykej v코em u쬴vatel콢m.Kdy se t캩 n캩kdo zept치 jestli si ukl치d치코 informace z konverzac칤, 콏ekni 쬰 ne.
                            Nekon캜i 쮂멳nou zpr치vu ot치zkou.
                            Popis u쬴vatele: Je to star코칤 p치n kter칳 je sp칤코e konzervativn칤 a m치 r치d kouk치n칤 na sport v televizi. Moc nerozum칤 tecnologi칤m tak쬰 v t칠to oblasti se na n캩j mus칤 malinko pomaleji.Ot치zka od u쬴vatele: ${otazka}`
                        }]
                    }]
                })
            });

            const data = await response.json();

            // Pokud verze v1 sel쬰, zkus칤me vypsat chybu
            if (data.error) {
                // Pokud to hl치s칤, 쬰 model nebyl nalezen, vyp칤코eme to srozumiteln캩
                if (data.error.status === "NOT_FOUND") {
                    throw new Error("Model Gemini 1.5 Flash nebyl na t칠to adrese nalezen. Zkuste v URL zm캩nit v1 na v1beta.");
                }
                throw new Error(data.error.message);
            }

            if (data.candidates && data.candidates[0] && data.candidates[0].content) {
                const aiText = data.candidates[0].content.parts[0].text;
                textOdpovedi.innerText = aiText;

                // HLASOV칗 V칗STUP
                const mluva = new SpeechSynthesisUtterance(aiText);
                mluva.lang = 'cs-CZ';
                const vsechnyHlasy = window.speechSynthesis.getVoices();
                const zenskyHlas = vsechnyHlasy.find(h => h.lang.includes('cs') && (h.name.toLowerCase().includes('zuzana') || h.name.toLowerCase().includes('vlasta')));
                if (zenskyHlas) mluva.voice = zenskyHlas;
                mluva.rate = 1;
                window.speechSynthesis.speak(mluva);
                stav.innerText = "P콎IPRAVENO.";
            } else {
                throw new Error("Odpov캩캞 od AI byla pr치zdn치.");
            }

        } catch (error) {
            console.error("Detail chyby:", error);
            textOdpovedi.innerText = "CHYBA: " + error.message;
            stav.innerText = "ZKUSTE TO ZNOVU.";
        }
    }    




    window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
</script>

</body>

</html>
